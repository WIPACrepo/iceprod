

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>RPC Internal &mdash; IceProd 2.0.4 documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/style.css" type="text/css" />
  

  

  
    <link rel="top" title="IceProd 2.0.4 documentation" href="../index.html"/>
        <link rel="up" title="IceProd Server" href="index.html"/>
        <link rel="next" title="Basic Configuration" href="basic_config.html"/>
        <link rel="prev" title="Condor Plugin" href="plugins/condor.html"/> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> IceProd
          

          
          </a>

          
            
            
              <div class="version">
                2.0.4
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul>
<li class="toctree-l1"><a class="reference internal" href="../overview.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../quickstart.html">Quickstart</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../core/index.html">IceProd Core</a></li>
</ul>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="index.html">IceProd Server</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="index.html#modules">Modules</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#plugins">Plugins</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html#regular-classes">Regular Classes</a><ul class="current">
<li class="toctree-l3 current"><a class="current reference internal" href="#">RPC Internal</a></li>
<li class="toctree-l3"><a class="reference internal" href="basic_config.html">Basic Configuration</a></li>
<li class="toctree-l3"><a class="reference internal" href="config.html">Detailed Configuration</a></li>
<li class="toctree-l3"><a class="reference internal" href="dbmethods.html">DB Methods</a></li>
<li class="toctree-l3"><a class="reference internal" href="file_io.html">File IO</a></li>
<li class="toctree-l3"><a class="reference internal" href="grid.html">Grid Queueing</a></li>
<li class="toctree-l3"><a class="reference internal" href="gridftp.html">Asynchronous GridFTP</a></li>
<li class="toctree-l3"><a class="reference internal" href="init.html">Server Init</a></li>
<li class="toctree-l3"><a class="reference internal" href="module.html">Module</a></li>
<li class="toctree-l3"><a class="reference internal" href="nginx.html">Nginx</a></li>
<li class="toctree-l3"><a class="reference internal" href="pool.html">Pool</a></li>
<li class="toctree-l3"><a class="reference internal" href="schedule.html">Schedule</a></li>
<li class="toctree-l3"><a class="reference internal" href="squid.html">Squid</a></li>
<li class="toctree-l3"><a class="reference internal" href="ssl_cert.html">SSL/TLS Certificate Utilities</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../details.html">Technical Details</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">IceProd</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div style="float:right">
            <a href="https://github.com/WIPACrepo/iceprod" class="fa fa-github"> Edit on GitHub</a>
          </div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="rpc-internal">
<span id="rpcinternal"></span><span id="index-0"></span><h1>RPC Internal<a class="headerlink" href="#rpc-internal" title="Permalink to this headline">¶</a></h1>
<p>Internal RPC relies on <a class="reference internal" href="details/zeromq.html#zeromq"><span class="std std-ref">ZeroMQ</span></a> sockets with a binary message protocol
to give speed, strong data integrity, and reliability.</p>
<dl class="class">
<dt id="iceprod.server.RPCinternal.Client">
<em class="property">class </em><code class="descclassname">iceprod.server.RPCinternal.</code><code class="descname">Client</code><span class="sig-paren">(</span><em>service_name=None</em>, <em>service_callback=None</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/iceprod/server/RPCinternal.html#Client"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#iceprod.server.RPCinternal.Client" title="Permalink to this definition">¶</a></dt>
<dd><p>ZMQ messaging client/service.</p>
<p>Start a client in a separate thread so it doesn&#8217;t block the caller.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>service_name</strong> &#8211; Name of service, optional</li>
<li><strong>service_callback</strong> &#8211; <p>Callback for service, optional</p>
<p>Function signature must be fn( data, callback=writer(msg) )</p>
</li>
<li><strong>address</strong> &#8211; Address to connect to</li>
<li><strong>immediate_setup</strong> &#8211; Setup socket immediately, optional</li>
<li><strong>history_length</strong> &#8211; Amount of history to keep track of, optional</li>
</ul>
</td>
</tr>
</tbody>
</table>
<dl class="method">
<dt id="iceprod.server.RPCinternal.Client.start">
<code class="descname">start</code><span class="sig-paren">(</span><em>*args</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/iceprod/server/RPCinternal.html#Client.start"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#iceprod.server.RPCinternal.Client.start" title="Permalink to this definition">¶</a></dt>
<dd><p>Start the Client</p>
</dd></dl>

<dl class="method">
<dt id="iceprod.server.RPCinternal.Client.stop">
<code class="descname">stop</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/iceprod/server/RPCinternal.html#Client.stop"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#iceprod.server.RPCinternal.Client.stop" title="Permalink to this definition">¶</a></dt>
<dd><p>Stop the Client</p>
</dd></dl>

<dl class="method">
<dt id="iceprod.server.RPCinternal.Client.kill">
<code class="descname">kill</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/iceprod/server/RPCinternal.html#Client.kill"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#iceprod.server.RPCinternal.Client.kill" title="Permalink to this definition">¶</a></dt>
<dd><p>Kill the Client, skipping the unregister step.</p>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="iceprod.server.RPCinternal.ThreadedClient">
<em class="property">class </em><code class="descclassname">iceprod.server.RPCinternal.</code><code class="descname">ThreadedClient</code><span class="sig-paren">(</span><em>**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/iceprod/server/RPCinternal.html#ThreadedClient"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#iceprod.server.RPCinternal.ThreadedClient" title="Permalink to this definition">¶</a></dt>
<dd><dl class="method">
<dt id="iceprod.server.RPCinternal.ThreadedClient.start">
<code class="descname">start</code><span class="sig-paren">(</span><em>*args</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/iceprod/server/RPCinternal.html#ThreadedClient.start"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#iceprod.server.RPCinternal.ThreadedClient.start" title="Permalink to this definition">¶</a></dt>
<dd><p>Start the Client</p>
</dd></dl>

<dl class="method">
<dt id="iceprod.server.RPCinternal.ThreadedClient.run">
<code class="descname">run</code><span class="sig-paren">(</span><em>*args</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/iceprod/server/RPCinternal.html#ThreadedClient.run"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#iceprod.server.RPCinternal.ThreadedClient.run" title="Permalink to this definition">¶</a></dt>
<dd><p>Thread runner</p>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="iceprod.server.RPCinternal.Server">
<em class="property">class </em><code class="descclassname">iceprod.server.RPCinternal.</code><code class="descname">Server</code><span class="sig-paren">(</span><em>**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/iceprod/server/RPCinternal.html#Server"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#iceprod.server.RPCinternal.Server" title="Permalink to this definition">¶</a></dt>
<dd><p>ZMQ messaging server.</p>
<p>Start a server in the current thread (blocking).</p>
<p>TODO: handle case of 2+ instances of same service</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>history_length</strong> &#8211; Amount of history to keep track of</li>
<li><strong>immediate_setup</strong> &#8211; Setup socket immediately, optional</li>
<li><strong>address</strong> &#8211; Address to bind to</li>
</ul>
</td>
</tr>
</tbody>
</table>
<dl class="method">
<dt id="iceprod.server.RPCinternal.Server.start">
<code class="descname">start</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/iceprod/server/RPCinternal.html#Server.start"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#iceprod.server.RPCinternal.Server.start" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="class">
<dt id="iceprod.server.RPCinternal.RPCService">
<em class="property">class </em><code class="descclassname">iceprod.server.RPCinternal.</code><code class="descname">RPCService</code><span class="sig-paren">(</span><em>address=None</em>, <em>block=True</em>, <em>timeout=60.0</em>, <em>io_loop=None</em>, <em>service_name=None</em>, <em>service_class=None</em>, <em>context=None</em>, <em>history_length=None</em>, <em>immediate_setup=None</em>, <em>async=None</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/iceprod/server/RPCinternal.html#RPCService"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#iceprod.server.RPCinternal.RPCService" title="Permalink to this definition">¶</a></dt>
<dd><p>An RPC version of the <code class="xref py py-class docutils literal"><span class="pre">Client</span></code></p>
<p>Once initialized, call like RPCService.service_name.method_name(kwargs)
with a named parameter &#8216;callback&#8217; for results.
Callback function gets one arg as the result, which could be an
Exception class.</p>
<p>RPC service functions are defined in a service_class via either static
or regular methods. Each function is called with kwargs from the client
and a &#8216;callback&#8217; response function for async.</p>
<p>Example RPC class:</p>
<div class="highlight-default"><div class="highlight"><pre><span class="k">class</span> <span class="nc">RPC</span><span class="p">():</span>
    <span class="k">def</span> <span class="nf">test</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">var1</span><span class="p">,</span><span class="n">var2</span><span class="p">,</span><span class="n">callback</span><span class="p">):</span>
        <span class="c"># do something with vars</span>
        <span class="c"># return directly for fast calls</span>
        <span class="k">return</span> <span class="n">var1</span>
    <span class="k">def</span> <span class="nf">test2</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">var3</span><span class="p">,</span><span class="n">var3</span><span class="p">,</span><span class="n">callback</span><span class="p">):</span>
        <span class="c"># do something else with vars</span>
        <span class="c"># very time consuming tasks should be done async, and passed the</span>
        <span class="c"># callback function to return a value</span>
        <span class="n">time_consumer</span><span class="p">(</span><span class="n">var3</span><span class="p">,</span><span class="n">callback</span><span class="o">=</span><span class="n">callback</span><span class="p">)</span>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">test3</span><span class="p">(</span><span class="n">callback</span><span class="p">):</span>
        <span class="c"># this is a bare method with no args, just a callback</span>
        <span class="k">pass</span> <span class="c"># and we don&#39;t even have to use it</span>
</pre></div>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>address</strong> &#8211; the address of the <code class="xref py py-class docutils literal"><span class="pre">Server</span></code></li>
<li><strong>block</strong> &#8211; whether to block or start a separate thread, optional,
defaults to True</li>
<li><strong>timeout</strong> &#8211; request timeout, optional,
defaults to 60.0 seconds</li>
<li><strong>io_loop</strong> &#8211; the Tornado io_loop to use, optional,
defaults to the main loop</li>
<li><strong>service_name</strong> &#8211; The service name, optional</li>
<li><strong>service_class</strong> &#8211; The RPC service class, optional</li>
<li><strong>context</strong> &#8211; A context manager for service calls, optional</li>
<li><strong>history_length</strong> &#8211; Amount of history to keep track of, optional</li>
<li><strong>immediate_setup</strong> &#8211; Setup socket immediately, optional</li>
<li><strong>async</strong> &#8211; Provide a default async value for RPC calls, optional</li>
</ul>
</td>
</tr>
</tbody>
</table>
<dl class="method">
<dt id="iceprod.server.RPCinternal.RPCService.setup">
<code class="descname">setup</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/iceprod/server/RPCinternal.html#RPCService.setup"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#iceprod.server.RPCinternal.RPCService.setup" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="iceprod.server.RPCinternal.RPCService.start">
<code class="descname">start</code><span class="sig-paren">(</span><em>*args</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/iceprod/server/RPCinternal.html#RPCService.start"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#iceprod.server.RPCinternal.RPCService.start" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="iceprod.server.RPCinternal.RPCService.stop">
<code class="descname">stop</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/iceprod/server/RPCinternal.html#RPCService.stop"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#iceprod.server.RPCinternal.RPCService.stop" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="iceprod.server.RPCinternal.RPCService.kill">
<code class="descname">kill</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/iceprod/server/RPCinternal.html#RPCService.kill"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#iceprod.server.RPCinternal.RPCService.kill" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="basic_config.html" class="btn btn-neutral float-right" title="Basic Configuration" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="plugins/condor.html" class="btn btn-neutral" title="Condor Plugin" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2016, IceCube Collaboration.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'2.0.4',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>