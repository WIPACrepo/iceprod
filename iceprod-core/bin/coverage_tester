#!/bin/sh
export LD_LIBRARY_PATH=$I3PREFIX/resource_libs:$LD_LIBRARY_PATH
CHOICE=$1
shift 1

cd $I3PREFIX;

if [ "$CHOICE" = "all" ]; then
    coverage run -p --source iceprod.core,$I3PREFIX/bin/i3exec.py,$I3PREFIX/bin/core_tester.py $I3PREFIX/bin/core_tester.py $@;
    coverage run -p --source iceprod.server,$I3PREFIX/bin/iceprod_server.py,$I3PREFIX/bin/server_tester.py $I3PREFIX/bin/server_tester.py $@;
    coverage combine;
    coverage html -i --directory=$I3PROD/var/www/coverage --omit=\*test\*;
    #coverage report -i -m;
elif [ "$CHOICE" = "core" ]; then
    coverage run -p --source iceprod.core,$I3PREFIX/bin/core_tester.py $I3PREFIX/bin/core_tester.py $@;
    coverage combine;
    coverage report -i -m --omit=\*test\*;
elif [ "$CHOICE" = "server" ]; then
    coverage run -p --source iceprod.server,$I3PREFIX/bin/server_tester.py $I3PREFIX/bin/server_tester.py $@;
    coverage combine;
    coverage report -i -m --omit=\*test\*;
else
    echo "Must select 'all', 'core', or 'server' to run coverage"
fi
