{
  "difplus":null,
  "tasks":[
    {
      "requirements":{
        "disk":10,
        "memory":2
      },
      "name":"generate",
      "parameters":{},
      "depends":[],
      "batchsys":null,
      "trays":[
        {
          "name":"corsika",
          "parameters":{},
          "modules":[
            {
              "name":"CorsikaBG",
              "resources":[],
              "data":[
                {
                  "remote":"",
                  "local":"corsika_bg.i3.zst",
                  "compression":false,
                  "type":"job_temp",
                  "movement":"output"
                }
              ],
              "classes":[],
              "parameters":{},
              "running_class":"icecube.simprod.modules.CorsikaGenerator",
              "src":"",
              "args":{
                "corsikaName":"dcorsika",
                "CORSIKAseed":"$steering(CORSIKA::seed)",
                "corsikaVersion":"$steering(dCORSIKA::version)",
                "eprimarymin":"$steering(dCORSIKA::eprimarymin)",
                "eprimarymax":"$steering(dCORSIKA::eprimarymax)",
                "gcdfile":"$steering(gcdfile)",
                "EnableHistogram":false,
                "HistogramFilename":"histo.pkl",
                "nproc":"$(jobs_submitted)",
                "nshowers":"$steering(dCORSIKA::showers)",
                "outputfile":"corsika_bg.i3.zst",
                "OverSampling":10,
                "LegacyOverSampling":true,
                "procnum":"$(job)",
                "ranpri":2,
                "RunCorsika":true,
                "seed":"$steering(seed)",
                "CylinderRadius":600,
                "CylinderHeight":1200,
                "skipoptions":[
                  "compress"
                ],
                "summaryfile":"bgsummary.xml",
                "UsePipe":false,
                "UseGSLRNG":true
              },
              "env_shell":"/cvmfs/icecube.opensciencegrid.org/py3-v4.3.0/icetray-env icetray/v1.10.0",
              "env_clear":true,
              "configs":{}
            },
            {
              "src":"",
              "resources":[],
              "name":"",
              "env_clear":true,
              "args":{
                "UseGSLRNG":true,
                "eprimarymin":"$steering(CORSIKA::eprimarymin)",
                "cvmfs":"/cvmfs/icecube.opensciencegrid.org/users/ice3simusr/corsika/",
                "corsikaVersion":"77500b",
                "CORSIKAseed":"$steering(CORSIKA::seed)",
                "RunCorsika":true,
                "seed":"$steering(seed)",
                "HistogramFilename":"histo.pkl",
                "CutoffType":"EnergyPerNucleon",
                "UsePipe":false,
                "outputfile":"corsika_presample.i3.zst",
                "eprimarymax":"$steering(CORSIKA::eprimarymax)",
                "oversampling":0,
                "procnum":"$(job)",
                "compress":true,
                "pnorm":[
                  10,
                  5,
                  3,
                  2,
                  1
                ],
                "nproc":"$(jobs_submitted)",
                "gcdfile":"$(gcdfile)",
                "nshowers":"$steering(CORSIKA::showers)",
                "ecuts1":100,
                "ecuts2":100,
                "pgam":[
                  2,
                  2,
                  2,
                  2,
                  2
                ],
                "summaryfile":"summary.json",
                "EnableHistogram":true
              },
              "env_shell":"/cvmfs/icecube.opensciencegrid.org/py3-v4.3.0/icetray-env icetray/v1.10.0",
              "classes":[],
              "running_class":"icecube.simprod.modules.Corsika5ComponentGenerator",
              "parameters":{},
              "data":[],
              "projects":[]
            },
            {
              "src":"/cvmfs/icecube.opensciencegrid.org/users/ice3simusr/simulation/scripts/resample.py",
              "resources":[],
              "name":"",
              "env_clear":true,
              "args":{
                "seed":"$steering(seed)",
                "inputfile":"corsika_presample.i3.zst",
                "outputfile":"corsika.i3.zst",
                "CylinderHeight":1600,
                "CylinderRadius":800,
                "OverSampling":1,
                "procnum":"$(job)",
                "nproc":"$(jobs_submitted)",
                "gcdfile":"$(gcdfile)",
                "UseGSLRNG":null,
                "PropagateMuons":null
              },
              "env_shell":"/cvmfs/icecube.opensciencegrid.org/py3-v4.3.0/icetray-env icetray/v1.10.0",
              "classes":[],
              "running_class":"",
              "parameters":{},
              "data":[
                {
                  "type":"job_temp",
                  "movement":"output",
                  "remote":"",
                  "compression":false,
                  "local":"corsika.i3.zst"
                },
                {
                  "remote":"$steering(TARGET::2023)/histos/corsika_5comp_$(job).pkl",
                  "compression":false,
                  "transfer":"exists",
                  "type":"permanent",
                  "local":"histo.pkl",
                  "movement":"output"
                }
              ],
              "projects":[]
            }
          ],
          "classes":[],
          "resources":[],
          "iterations":1,
          "data":[],
          "projects":[]
        }
      ],
      "projects":[],
      "classes":[],
      "data":[],
      "resources":[]
    },
    {
      "requirements":{
        "gpu":1,
        "disk":15,
        "memory":5.5
      },
      "name":"hits",
      "parameters":{},
      "depends":[
        "generate"
      ],
      "batchsys":{
        "condor":{
          "requirements":"!regexp(\"^Louisiana\", GLIDEIN_Site) && !regexp(\"^Portland\", GLIDEIN_Site) && !regexp(\"^Kansas\", GLIDEIN_Site) && !regexp(\"ARGO\", GLIDEIN_Site) && !regexp(\"LSU\", GLIDEIN_Site) && !regexp(\"PDX\", GLIDEIN_Site) && !regexp(\"ND_CAMLGPU\",GLIDEIN_Site)"
        }
      },
      "trays":[
        {
          "name":"propagate",
          "parameters":{},
          "modules":[
            {
              "src":"",
              "resources":[],
              "name":"clsim",
              "env_clear":true,
              "args":{
                "UseGSLRNG":true,
                "holeiceparametrization":"$steering(HoleIcePath)/$steering(HoleIce)",
                "outputfile":"signalhits.i3.zst",
                "IceModel":"$steering(IceModel)",
                "IceModelLocation":"$steering(IceSimPath)/ice-models/resources/models/ICEMODEL/",
                "efficiency":"$steering(DOMefficiency)",
                "runmphitfilter":true,
                "KeepPureBackground":true,
                "PropagateMuons":false,
                "summaryfile":"summary.json",
                "seed":"$steering(seed)",
                "nproc":"$(jobs_submitted)",
                "UseGPUs":true,
                "inputfilelist":[
                  "corsika.i3.zst"
                ],
                "oversize":1,
                "gcdfile":"$(gcdfile)",
                "procnum":"$(job)"
              },
              "env_shell":"/cvmfs/icecube.opensciencegrid.org/py3-v4.3.0/icetray-env icetray/v1.10.0",
              "classes":[],
              "running_class":"icecube.simprod.modules.ClSim",
              "parameters":{},
              "data":[
                {
                  "type":"job_temp",
                  "movement":"input",
                  "remote":"",
                  "compression":false,
                  "local":"corsika.i3.zst"
                },
                {
                  "remote":"",
                  "local":"corsika_bg.i3.zst",
                  "compression":false,
                  "type":"job_temp",
                  "movement":"input"
                },
                {
                  "type":"permanent",
                  "movement":"output",
                  "remote":"$steering(TARGET::2023)/generated/$sprintf('corsika.%06d.%06d.i3.zst',$(dataset),$(job))",
                  "compression":false,
                  "local":"corsika.i3.zst"
                }
              ],
              "projects":[]
            },
            {
              "src":"",
              "resources":[],
              "name":"polyplopia",
              "env_clear":true,
              "args":{
                "UseGSLRNG":true,
                "holeiceparametrization":"$steering(HoleIcePath)/$steering(HoleIce)",
                "outputfile":"hits.i3.zst",
                "IceModel":"$steering(IceModel)",
                "efficiency":"$steering(DOMefficiency)",
                "nproc":"$(jobs_submitted)",
                "backgroundfile":"corsika_bg.i3.zst",
                "IceModelLocation":"$steering(IceSimPath)/ice-models/resources/models/ICEMODEL/",
                "seed":"$steering(seed)",
                "UseGPUs":true,
                "oversize":1,
                "gcdfile":"$(gcdfile)",
                "inputfile":"signalhits.i3.zst",
                "procnum":"$(job)"
              },
              "env_shell":"/cvmfs/icecube.opensciencegrid.org/py3-v4.3.0/icetray-env icetray/v1.10.0",
              "classes":[],
              "running_class":"icecube.simprod.modules.PolyplopiaModule",
              "parameters":{},
              "data":[
                {
                  "type":"job_temp",
                  "movement":"output",
                  "remote":"",
                  "compression":false,
                  "local":"hits.i3.zst"
                }
              ],
              "projects":[]
            }
          ],
          "classes":[],
          "resources":[],
          "iterations":1,
          "data":[],
          "projects":[]
        }
      ],
      "projects":[],
      "classes":[],
      "data":[],
      "resources":[]
    },
    {
      "requirements":{
        "memory":8
      },
      "name":"detector",
      "parameters":{},
      "depends":[
        "hits"
      ],
      "batchsys":null,
      "trays":[
        {
          "name":"ic86",
          "parameters":{},
          "modules":[
            {
              "src":"",
              "resources":[],
              "name":"",
              "env_clear":true,
              "args":{
                "UseGSLRNG":true,
                "outputfile":"$steering(outfile).i3.zst",
                "MCType":"$steering(mctype)",
                "UseLinearTree":true,
                "SkipKeys":[
                  "SignalI3MCPEs",
                  "PhotonSeriesMap",
                  "BackgroundI3MCPESeriesMap",
                  "I3MCPESeriesMap",
                  "I3MCPESeriesMapWithoutNoise"
                ],
                "MCPrescale":"$steering(MCPrescale)",
                "EnableHistogram":false,
                "LowMem":true,
                "HistogramFilename":"histo.pkl",
                "RunID":"$steering(CORSIKA::run)",
                "NProc":"$(jobs_submitted)",
                "gcdfile":"$(gcdfile)",
                "inputfile":"hits.i3.zst",
                "seed":"$steering(seed)",
                "ProcNum":"$(job)"
              },
              "env_shell":"/cvmfs/icecube.opensciencegrid.org/py3-v4.3.0/icetray-env icetray/v1.10.0",
              "classes":[],
              "running_class":"icecube.simprod.modules.IceCube",
              "parameters":{},
              "data":[
                {
                  "type":"job_temp",
                  "movement":"input",
                  "remote":"",
                  "compression":false,
                  "local":"hits.i3.zst"
                },
                {
                  "type":"permanent",
                  "movement":"output",
                  "remote":"$(TARGET::2023)/$steering(outfile).i3.zst",
                  "compression":false,
                  "local":"$steering(outfile).i3.zst"
                }
              ],
              "projects":[]
            }
          ],
          "classes":[],
          "resources":[],
          "iterations":1,
          "data":[
            {
              "remote":"$steering(TARGET::2023)/histos/detector_$(job).pkl",
              "compression":false,
              "transfer":"exists",
              "type":"permanent",
              "local":"histo.pkl",
              "movement":"output"
            }
          ],
          "projects":[]
        }
      ],
      "projects":[],
      "classes":[],
      "data":[],
      "resources":[]
    },
    {
      "requirements":{
        "memory":4
      },
      "name":"filtering",
      "parameters":{},
      "depends":[
        "detector"
      ],
      "batchsys":null,
      "trays":[
        {
          "name":"L1",
          "parameters":{},
          "modules":[
            {
              "src":"/cvmfs/icecube.opensciencegrid.org/py3-v4.1.1/metaprojects/icetray/v1.3.3/filterscripts/resources/scripts/SimulationFiltering.py",
              "resources":[],
              "name":"",
              "env_clear":true,
              "args":{
                "output":"$steering(FILTER::infile)",
                "photonicsdir":"/cvmfs/icecube.opensciencegrid.org/data/photon-tables",
                "gcd":"$(gcdfile)",
                "needs_wavedeform_spe_corr":null,
                "input":"$steering(outfile).i3.zst",
                "MinBiasPrescale":1000
              },
              "env_shell":"/cvmfs/icecube.opensciencegrid.org/py3-v4.3.0/icetray-env icetray/v1.10.0",
              "classes":[],
              "running_class":"",
              "parameters":{},
              "data":[
                {
                  "type":"permanent",
                  "movement":"input",
                  "remote":"$(TARGET::2023)/$steering(outfile).i3.zst",
                  "compression":false,
                  "local":"$steering(outfile).i3.zst"
                }
              ],
              "projects":[]
            }
          ],
          "classes":[],
          "resources":[],
          "iterations":1,
          "data":[],
          "projects":[]
        },
        {
          "name":"L2",
          "parameters":{},
          "modules":[
            {
              "src":"/cvmfs/icecube.opensciencegrid.org/py3-v4.1.1/metaprojects/icetray/v1.3.3/filterscripts/resources/scripts/offlineL2/process.py",
              "resources":[],
              "name":"",
              "env_clear":true,
              "args":{
                "output":"$steering(FILTER::outfile)",
                "photonicsdir":"/cvmfs/icecube.opensciencegrid.org/data/photon-tables",
                "gcd":"$(gcdfile)",
                "input":"$steering(FILTER::infile)",
                "simulation":null
              },
              "env_shell":"/cvmfs/icecube.opensciencegrid.org/py3-v4.1.1/icetray-env icetray/v1.3.3",
              "classes":[],
              "running_class":"",
              "parameters":{},
              "data":[
                {
                  "type":"permanent",
                  "movement":"output",
                  "remote":"$steering(TARGET::2023_L2)/$steering(FILTER::outfile)",
                  "compression":false,
                  "local":"$steering(FILTER::outfile)"
                }
              ],
              "projects":[]
            }
          ],
          "classes":[],
          "resources":[],
          "iterations":1,
          "data":[],
          "projects":[]
        }
      ],
      "projects":[],
      "classes":[],
      "data":[],
      "resources":[]
    },
    {
      "name":"PFFilt23",
      "resources":[],
      "data":[],
      "classes":[],
      "parameters":{},
      "depends":[
        "detector"
      ],
      "batchsys":null,
      "requirements":{
        "cpu":1,
        "disk":1,
        "gpu":0,
        "memory":1,
        "time":1
      },
      "trays":[
        {
          "name":"",
          "resources":[],
          "data":[],
          "classes":[],
          "parameters":{},
          "iterations":1,
          "modules":[
            {
              "name":"PFFilt",
              "resources":[],
              "data":[
                {
                  "remote":"$(TARGET::2023)/$steering(outfile).i3.zst",
                  "local":"$steering(outfile).i3.zst",
                  "compression":false,
                  "type":"job_temp",
                  "movement":"input"
                },
                {
                  "remote":"$steering(TARGET::PFFilt)/PFFilt_$steering(outfile).i3.zst",
                  "local":"pffilt.i3.zst",
                  "compression":false,
                  "type":"permanent",
                  "movement":"output"
                }
              ],
              "classes":[],
              "parameters":{},
              "running_class":"",
              "src":"$steering(IceSimPath)/online_filterscripts/resources/scripts/PFRaw_to_DST.py",
              "args":{
                "sim":null,
                "input":"$steering(outfile).i3.zst",
                "gcd":"$(gcdfile)",
                "output":"pffilt.i3.zst"
              },
              "env_shell":"/cvmfs/icecube.opensciencegrid.org/py3-v4.3.0/icetray-env icetray/v1.10.0",
              "env_clear":true,
              "configs":{}
            }
          ]
        }
      ],
      "task_files":false
    }
  ],
  "description":"IC86.2023 CORSIKA-in-ice 5-component model Sibyll2.3d with weighted spectrum of E^-2.0, reduced muon energy threshold, using Spice ftp-v3, HoleIce p0=0.2, p1=-0.05 ClSim. Angular range of 0deg < theta < 89.99deg and energy range of 1e6GeV < Eprim < 1e10GeV. DOM oversize = 1",
  "parent_id":20778,
  "version":3,
  "steering":{
    "batchsys":null,
    "data":[],
    "system":{},
    "parameters":{
      "spectrum":"E^-2.0",
      "seed":"$(dataset)",
      "year":2023,
      "category":"CORSIKA-in-ice",
      "CORSIKA::eprimarymin":600,
      "CORSIKA::eprimarymax":1000000,
      "CORSIKA::run":"$eval($eval($(dataset)*100000 + $(job))%100000000 + 1)",
      "CORSIKA::showers":500000,
      "CORSIKA::seed":"$eval($eval($(dataset)*100000 + $(job))%100000000)",
      "CORSIKA::spectrum":-2,
      "dCORSIKA::eprimarymin":600,
      "dCORSIKA::eprimarymax":"1e8",
      "dCORSIKA::run":"$eval($eval($(dataset)*100000 + $(job))%100000000 + 1)",
      "dCORSIKA::seed":"$steering(seed)",
      "dCORSIKA::showers":"$(CORSIKA::showers)",
      "dCORSIKA::version":"v6960-5comp",
      "subdirectory":"$sprintf('%07d-%07d',$eval($(job)//1000*1000),$eval($(job)//1000*1000+999))",
      "MCType":"corsika_weighted",
      "oversampling":1,
      "composition":"5-component",
      "photonpropagator":"CLSim",
      "IceModel":"spice_ftp-v3",
      "HoleIce":"angsens_unified_ftp/as.0",
      "HoleIcePath":"/cvmfs/icecube.opensciencegrid.org/users/ice3simusr/simulation/ANGSENS",
      "mjd_20":59000,
      "DOMefficiency":1,
      "outfile":"$sprintf('%s_corsika.%06d.%06d',$steering(geometry),$(dataset),$(job))",
      "gcdfile":"/cvmfs/icecube.opensciencegrid.org/data/GCD/GeoCalibDetectorStatus_2020.Run134142.Pass2_V0.i3.gz",
      "FILTER::infile":"PFFilt_$steering(outfile).i3.zst",
      "IceSimPath":"/cvmfs/icecube.opensciencegrid.org/py3-v4.3.0/metaprojects/icetray/v1.10.0",
      "MCPrescale":1000,
      "geometry":"IC86.2023",
      "FILTER::outfile":"Level2_$steering(outfile).i3.zst",
      "TARGET::2023":"gsiftp://gridftp.icecube.wisc.edu/data/user/dschultz/iceprod3-tests/generated/$(category)/$(dataset)/$(subdirectory)",
      "TARGET::PFFilt":"gsiftp://gridftp.icecube.wisc.edu/data/user/dschultz/iceprod3-tests/filtered/PFFilt/$(category)/$(dataset)/$(subdirectory)",
      "TARGET::2023_L2":"gsiftp://gridftp.icecube.wisc.edu/data/user/dschultz/iceprod3-tests/filtered/level2/$(category)/$(dataset)/$(subdirectory)",
      "hadronicinteraction":"Sybill-2.3d"
    },
    "resources":[]
  },
  "options":{},
  "categories":[]
}
