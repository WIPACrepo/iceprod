

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Extras &mdash; IceProd 2.1.1 documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/style.css" type="text/css" />
  

  

  
    <link rel="top" title="IceProd 2.1.1 documentation" href="index.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> IceProd
          

          
          </a>

          
            
            
              <div class="version">
                2.1.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul>
<li class="toctree-l1"><a class="reference internal" href="overview.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="guide/index.html">User&#8217;s Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="core/index.html">IceProd Core</a></li>
<li class="toctree-l1"><a class="reference internal" href="server/index.html">IceProd Server</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="dev_notes.html">Dev Notes</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">IceProd</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div style="float:right">
            <a href="https://github.com/WIPACrepo/iceprod" class="fa fa-github"> Edit on GitHub</a>
          </div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="extras">
<span id="technical-extras"></span><span id="index-0"></span><h1>Extras<a class="headerlink" href="#extras" title="Permalink to this headline">¶</a></h1>
<div class="section" id="site-pools">
<h2>Site Pools<a class="headerlink" href="#site-pools" title="Permalink to this headline">¶</a></h2>
<p>Sites can connect to each other in a <em>pool</em> to create a network of sites.  This allows datasets and resources to be used across multiple sites.  One of the main requirements of a pool is the election of a master.  When a pool is first created by connecting two nodes together, IceProd will ask which node should be the master.</p>
</div>
<div class="section" id="the-role-of-the-master">
<h2>The Role of the Master<a class="headerlink" href="#the-role-of-the-master" title="Permalink to this headline">¶</a></h2>
<p>The master stores a copy of all dataset and task information in the pool.  This allows it to display and control all actions in the pool.</p>
<p>The master is also a central repository for resources needed by datasets running on multiple sites or sites other than the one they are submitted from.  An external gridftp server can be designated as the repository location for the master to use.</p>
<div class="section" id="queueing-to-multiple-sites">
<h3>Queueing to Multiple Sites<a class="headerlink" href="#queueing-to-multiple-sites" title="Permalink to this headline">¶</a></h3>
<p>Queueing a dataset to multiple sites is handled by the master.  Whenever a site asks the master for more tasks (in the <a class="reference internal" href="server/modules/queue.html#queueing-module"><span class="std std-ref">Queueing Module</span></a>), the master will assign waiting tasks to that site.  This is a pull paradigm; there is no push capability.</p>
<p>If the site fails to change the state of an assigned task for more than a timeout period, the task is reassigned to another site.  This allows the task to run even if the site goes down.</p>
</div>
<div class="section" id="communicating-with-the-master">
<h3>Communicating with the Master<a class="headerlink" href="#communicating-with-the-master" title="Permalink to this headline">¶</a></h3>
<p>Sites communicate with the master via json-rpc through the master website.  If communication fails, commands are queued in a buffer until communication succeeds again.  If the site&#8217;s server is restarted, this buffer is erased so the site is declared out of sync and must resync with the master before continuing.</p>
</div>
</div>
<div class="section" id="the-backup-master">
<h2>The Backup Master<a class="headerlink" href="#the-backup-master" title="Permalink to this headline">¶</a></h2>
<p>The backup master contains a copy of all data contained in the master (except possibly the most recent changes).  Its job is to take over the duties of the master temporarily while the master is offline.  When the master comes back online, it first resyncs with the backup master before resuming duties.  In the event that the master has been replaced, the old master will become a regular site.</p>
<p>Note that the backup master is a configurable option that can be disabled, and by default is disabled on smaller site pools.</p>
<div class="section" id="exceptions-to-backup-master-synchronization">
<h3>Exceptions to Backup Master Synchronization<a class="headerlink" href="#exceptions-to-backup-master-synchronization" title="Permalink to this headline">¶</a></h3>
<p>Many of the operations of the master are not guaranteed to be mirrored immediately on the backup master because of performance limitations.  Instead they are queued for bulk transfer and the operation can succeed before the backup master is updated.</p>
<p>For these limited types of operations, the backup master is updated before the operation is completed:</p>
<ul class="simple">
<li>Creating a new dataset</li>
<li>Altering a dataset configuration</li>
</ul>
</div>
<div class="section" id="backup-master-failure">
<h3>Backup Master Failure<a class="headerlink" href="#backup-master-failure" title="Permalink to this headline">¶</a></h3>
<p>In the event of backup master failure, a set timeout limit is enforced before a new backup master is elected among the connected sites.</p>
</div>
</div>
<div class="section" id="joining-a-pool">
<h2>Joining a Pool<a class="headerlink" href="#joining-a-pool" title="Permalink to this headline">¶</a></h2>
<p>Sites can join a pool at any time, but it is best to do it close to the creation of the site.  This is because there is a small probability that the randomly generated site id will already be taken in the pool, causing all global ids (dataset ids, task ids, and others) to be updated with a new site id.</p>
<div class="section" id="global-site-ids">
<h3>Global Site Ids<a class="headerlink" href="#global-site-ids" title="Permalink to this headline">¶</a></h3>
<p>Each id must be globally unique across all sites in the pool.  However, each site can create new datasets and other objects independently.  Using a standard autoincrement id would fail under this case.  Instead, we partition the allowable range of ids by using the site id, which identifies which partition we are in.</p>
<p>Example:</p>
<div class="line-block">
<div class="line"><br /></div>
<div class="line-block">
<div class="line">Site A has a site_id = 0, so has a range of [0-1)x10^12</div>
<div class="line">Site B has a site_id = 1, so has a range of [1-2)x10^12</div>
<div class="line"><br /></div>
<div class="line">When site A creates a new global id, the id is i+0x10^12</div>
<div class="line">When site B creates a new global id, the id is i+1x10^12</div>
</div>
</div>
<p>Because sites can be started and run independently before connecting to a pool, we need to assign them a random id from a decently large space to lower the risk of collision (it might still happen, but very infrequently).  So we need &gt; 10^9 possible sites and &gt; 10^12 possible ids.</p>
<p>This presents an additional challenge: integers are not large enough to handle that much range (they go up to 10^18).  The solution is to use a string of characters as the id.  [a-zA-Z0-9] should be plenty.  This gives us the following possibilities:</p>
<blockquote>
<div><dl class="docutils">
<dt>12 chars gives 10^21 ids</dt>
<dd><ul class="first last simple">
<li>10^9 sites with 10^12 ids for each DB table</li>
</ul>
</dd>
<dt>15 chars gives 10^26 ids</dt>
<dd><ul class="first last simple">
<li>10^10 sites with 10^16 ids for each DB table</li>
</ul>
</dd>
<dt>20 chars gives 10^35 ids</dt>
<dd><ul class="first last simple">
<li>Only if you want to be very future proof</li>
</ul>
</dd>
</dl>
</div></blockquote>
<p>The 15 char length was selected for IceProd 2.  This is hard coded into <a class="reference internal" href="server/init.html#iceprod.server.GlobalID" title="iceprod.server.GlobalID"><code class="xref py py-class docutils literal"><span class="pre">iceprod.server.GlobalID</span></code></a>.  If this is changed, all old DB data is lost and you will not be able to connect properly to a pool using a different value.  So make sure this is set for your use case before starting to use IceProd</p>
</div>
</div>
<div class="section" id="pool-security">
<h2>Pool Security<a class="headerlink" href="#pool-security" title="Permalink to this headline">¶</a></h2>
<p>All communication is encrypted with SSL certificates.  The master is capable of creating its own CA certificate, or a CA certificate can be given at formation (note: the certificate must be able to sign other certificates).  When new sites join the pool, they receive a certificate signed by the master to use for all communications.  Tasks receive a CA certificate bundle that includes the master and site certificates, allowing them to verify that they are communicating with a server in the pool.</p>
</div>
</div>


           </div>
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2016, IceCube Collaboration.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'2.1.1',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>