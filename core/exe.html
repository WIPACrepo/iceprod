

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Execution Functions &mdash; IceProd master documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/style.css" type="text/css" />
  

  

  
    <link rel="top" title="IceProd master documentation" href="../index.html"/>
        <link rel="up" title="IceProd Core" href="index.html"/>
        <link rel="next" title="Execution Helpers" href="exe_helper.html"/>
        <link rel="prev" title="I3Exec" href="i3exec.html"/> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> IceProd
          

          
          </a>

          
            
            
              <div class="version">
                master
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../overview.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../guide/index.html">User&#8217;s Guide</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">IceProd Core</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="i3exec.html">I3Exec</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Execution Functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="exe_helper.html">Execution Helpers</a></li>
<li class="toctree-l2"><a class="reference internal" href="exe_json.html">JSONRPC Calls</a></li>
<li class="toctree-l2"><a class="reference internal" href="jsonRPCclient.html">JSON-RPC Client</a></li>
<li class="toctree-l2"><a class="reference internal" href="jsonUtil.html">JSON Utilities</a></li>
<li class="toctree-l2"><a class="reference internal" href="init.html">Core Init</a></li>
<li class="toctree-l2"><a class="reference internal" href="dataclasses.html">Dataclasses</a></li>
<li class="toctree-l2"><a class="reference internal" href="parser.html">Meta-Language Parser</a></li>
<li class="toctree-l2"><a class="reference internal" href="functions.html">Functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="serialization.html">Serialization</a></li>
<li class="toctree-l2"><a class="reference internal" href="gridftp.html">GridFTP</a></li>
<li class="toctree-l2"><a class="reference internal" href="util.html">Utilities</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../server/index.html">IceProd Server</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../dev_notes.html">Dev Notes</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">IceProd</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div style="float:right">
            <a href="https://github.com/WIPACrepo/iceprod" class="fa fa-github"> Edit on GitHub</a>
          </div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="module-iceprod.core.exe">
<span id="execution-functions"></span><h1>Execution Functions<a class="headerlink" href="#module-iceprod.core.exe" title="Permalink to this headline">¶</a></h1>
<p>The core execution functions for running on a node.
These are all called from <a class="reference internal" href="i3exec.html#module-iceprod.core.i3exec" title="iceprod.core.i3exec"><code class="xref any py py-mod docutils literal"><span class="pre">iceprod.core.i3exec</span></code></a>.</p>
<p>The fundamental design of the core is to run a task composed of trays and
modules.  The general heirarchy looks like:</p>
<div class="highlight-default"><div class="highlight"><pre><span class="n">task</span>
<span class="o">|</span>
<span class="o">|-</span> <span class="n">tray1</span>
   <span class="o">|</span>
   <span class="o">|-</span> <span class="n">module1</span>
   <span class="o">|</span>
   <span class="o">|-</span> <span class="n">module2</span>
<span class="o">|</span>
<span class="o">|-</span> <span class="n">tray2</span>
   <span class="o">|</span>
   <span class="o">|-</span> <span class="n">module3</span>
   <span class="o">|</span>
   <span class="o">|-</span> <span class="n">module4</span>
</pre></div>
</div>
<p>Parameters can be defined at every level, and each level is treated as a
scope (such that inner scopes inherit from outer scopes).  This is
accomplished via an internal evironment for each scope.</p>
<div class="section" id="environment-functions">
<h2>Environment Functions<a class="headerlink" href="#environment-functions" title="Permalink to this headline">¶</a></h2>
<p>The internal IceProd environment, designed to be nested and clean up after itself.</p>
<dl class="class">
<dt id="iceprod.core.exe.Config">
<em class="property">class </em><code class="descclassname">iceprod.core.exe.</code><code class="descname">Config</code><span class="sig-paren">(</span><em>config=None</em>, <em>parser=None</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/iceprod/core/exe.html#Config"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#iceprod.core.exe.Config" title="Permalink to this definition">¶</a></dt>
<dd><p>Contain the configuration and related methods</p>
<dl class="method">
<dt id="iceprod.core.exe.Config.parseValue">
<code class="descname">parseValue</code><span class="sig-paren">(</span><em>value</em>, <em>env={}</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/iceprod/core/exe.html#Config.parseValue"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#iceprod.core.exe.Config.parseValue" title="Permalink to this definition">¶</a></dt>
<dd><p>Parse a value from the available env and global config.</p>
<p>Uses the <a class="reference internal" href="parser.html#module-iceprod.core.parser" title="iceprod.core.parser"><code class="xref py py-class docutils literal"><span class="pre">Meta</span> <span class="pre">Parser</span></code></a> on any string value.
Pass-through for any other object.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>value</strong> &#8211; The value to parse</li>
<li><strong>env</strong> &#8211; The environment to use, optional</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">The parsed value</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="iceprod.core.exe.Config.parseObject">
<code class="descname">parseObject</code><span class="sig-paren">(</span><em>obj</em>, <em>env</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/iceprod/core/exe.html#Config.parseObject"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#iceprod.core.exe.Config.parseObject" title="Permalink to this definition">¶</a></dt>
<dd><p>Recursively parse a dict or list</p>
</dd></dl>

</dd></dl>

<dl class="function">
<dt id="iceprod.core.exe.setupenv">
<code class="descclassname">iceprod.core.exe.</code><code class="descname">setupenv</code><span class="sig-paren">(</span><em>*args</em>, <em>**kwds</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/iceprod/core/exe.html#setupenv"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#iceprod.core.exe.setupenv" title="Permalink to this definition">¶</a></dt>
<dd><p>The internal environment (env) is a dictionary composed of several objects:</p>
<dl class="docutils">
<dt>parameters</dt>
<dd>Parameters are defined directly as an object, or as a string pointing
to another object.  They can use the IceProd meta-language to be
defined in relation to other parameters specified in inherited
scopes, or as eval or sprinf functions.</dd>
<dt>resources</dt>
<dd></dd>
<dt>data</dt>
<dd>Resources and data are similar in that they handle extra files that
modules may create or use.  The difference is that resources are only
for reading, such as pre-built lookup tables, while data can be input
and/or output. Compression can be automatically handled by IceProd.
Both resources and data are defined in the environment as strings to
their file location.</dd>
<dt>classes</dt>
<dd>This is where external software gets added.  The software can be an
already downloaded resource or just a url to download.  All python
files get added to the python path and binary libraries get symlinked
into a directory on the LD_LIBRARY_PATH.  Note that if there is more
than one copy of the same shared library file, only the most recent
one is in scope.  Classes are defined in the environment as strings
to their file location.</dd>
<dt>deletions</dt>
<dd>These are files that should be deleted when the scope ends.</dd>
<dt>uploads</dt>
<dd>These are files that should be uploaded when the scope ends.
Mostly Data objects that are used as output.</dd>
<dt>shell environment</dt>
<dd>An environment to reset to when exiting the context manager.</dd>
</dl>
<p>To keep the scope correct a new dictionary is created for every level, then
the inheritable objects are shallow copied (to 1 level) into the new env.
The deletions are not inheritable (start empty for each scope), and the shell
environment is set at whatever the previous scope currently has.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>cfg</strong> (<a class="reference internal" href="#iceprod.core.exe.Config" title="iceprod.core.exe.Config"><code class="xref py py-class docutils literal"><span class="pre">Config</span></code></a>) &#8211; Config object</li>
<li><strong>obj</strong> (<a class="reference external" href="https://docs.python.org/3.6/library/stdtypes.html#dict" title="(in Python v3.6)"><em>dict</em></a>) &#8211; A dict-like object from <a class="reference internal" href="dataclasses.html#module-iceprod.core.dataclasses" title="iceprod.core.dataclasses"><code class="xref py py-mod docutils literal"><span class="pre">iceprod.core.dataclasses</span></code></a>
such as <a class="reference internal" href="dataclasses.html#iceprod.core.dataclasses.Steering" title="iceprod.core.dataclasses.Steering"><code class="xref py py-class docutils literal"><span class="pre">iceprod.core.dataclasses.Steering</span></code></a>.</li>
<li><strong>oldenv</strong> (<a class="reference external" href="https://docs.python.org/3.6/library/stdtypes.html#dict" title="(in Python v3.6)"><em>dict</em></a>) &#8211; (optional) env that we are running inside</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</div>
<div class="section" id="run-functions">
<h2>Run Functions<a class="headerlink" href="#run-functions" title="Permalink to this headline">¶</a></h2>
<p>The main execution flow goes through here.</p>
<dl class="function">
<dt id="iceprod.core.exe.runtask">
<code class="descclassname">iceprod.core.exe.</code><code class="descname">runtask</code><span class="sig-paren">(</span><em>cfg</em>, <em>globalenv</em>, <em>task</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/iceprod/core/exe.html#runtask"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#iceprod.core.exe.runtask" title="Permalink to this definition">¶</a></dt>
<dd><p>Run the specified task</p>
</dd></dl>

<dl class="function">
<dt id="iceprod.core.exe.runtray">
<code class="descclassname">iceprod.core.exe.</code><code class="descname">runtray</code><span class="sig-paren">(</span><em>cfg</em>, <em>globalenv</em>, <em>tray</em>, <em>stats={}</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/iceprod/core/exe.html#runtray"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#iceprod.core.exe.runtray" title="Permalink to this definition">¶</a></dt>
<dd><p>Run the specified tray</p>
</dd></dl>

<dl class="function">
<dt id="iceprod.core.exe.runmodule">
<code class="descclassname">iceprod.core.exe.</code><code class="descname">runmodule</code><span class="sig-paren">(</span><em>cfg</em>, <em>globalenv</em>, <em>module</em>, <em>stats={}</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/iceprod/core/exe.html#runmodule"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#iceprod.core.exe.runmodule" title="Permalink to this definition">¶</a></dt>
<dd><p>Run the specified module</p>
</dd></dl>

</div>
<div class="section" id="object-setup">
<h2>Object Setup<a class="headerlink" href="#object-setup" title="Permalink to this headline">¶</a></h2>
<p>Download/upload and setup the main IceProd objects (Resources, Data, Classes).</p>
<dl class="function">
<dt id="iceprod.core.exe.downloadResource">
<code class="descclassname">iceprod.core.exe.</code><code class="descname">downloadResource</code><span class="sig-paren">(</span><em>env</em>, <em>resource</em>, <em>remote_base=None</em>, <em>local_base=None</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/iceprod/core/exe.html#downloadResource"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#iceprod.core.exe.downloadResource" title="Permalink to this definition">¶</a></dt>
<dd><p>Download a resource and put location in the env</p>
</dd></dl>

<dl class="function">
<dt id="iceprod.core.exe.downloadData">
<code class="descclassname">iceprod.core.exe.</code><code class="descname">downloadData</code><span class="sig-paren">(</span><em>env</em>, <em>data</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/iceprod/core/exe.html#downloadData"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#iceprod.core.exe.downloadData" title="Permalink to this definition">¶</a></dt>
<dd><p>Download data and put location in the env</p>
</dd></dl>

<dl class="function">
<dt id="iceprod.core.exe.uploadData">
<code class="descclassname">iceprod.core.exe.</code><code class="descname">uploadData</code><span class="sig-paren">(</span><em>env</em>, <em>data</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/iceprod/core/exe.html#uploadData"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#iceprod.core.exe.uploadData" title="Permalink to this definition">¶</a></dt>
<dd><p>Upload data</p>
</dd></dl>

<dl class="function">
<dt id="iceprod.core.exe.setupClass">
<code class="descclassname">iceprod.core.exe.</code><code class="descname">setupClass</code><span class="sig-paren">(</span><em>env</em>, <em>class_obj</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/iceprod/core/exe.html#setupClass"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#iceprod.core.exe.setupClass" title="Permalink to this definition">¶</a></dt>
<dd><p>Set up a class for use in modules, and put it in the env</p>
</dd></dl>

</div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="exe_helper.html" class="btn btn-neutral float-right" title="Execution Helpers" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="i3exec.html" class="btn btn-neutral" title="I3Exec" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2016, IceCube Collaboration.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'master',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>