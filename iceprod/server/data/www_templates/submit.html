{% extends "base.html" %}

{% autoescape None %}

{% block title %}IceProd{% end %}

{% block head_scripts %}
<link rel="stylesheet" href="/static/submit.css" media="all" type="text/css" />
{% end %}

{% block page_title %}Submit{% end %}

{% block body %}
<div id="submit_area">Enable javsascript to submit datasets.</div>

<div id="error"></div>

{% end %}

{% block body_scripts %}
<script id="LoopTmpl" type="text/x-jsrender">
<div class="indent {{!:~key}}">
    <span class="path">{{!:~concat(~path,#index,~key)}}</span>
    {^{props ~path=~concat(~path,#index,~key) tmpl="#EditTmpl" /}}
</div>
</script>
<script id="LoopTmplBasic" type="text/x-jsrender">
<div class="indent {{!:~key}}">
    <span class="path">{{!:~concat(~path,#index,~key)}}</span>
    <div>
    {^{if ~editable(~concat(~path,#index,~key))}}
        <span class="editing"><span class="key hide"></span><input type="text" data-link="{intToStr:#data:strToInt}" /></span>
    {{!else}}
        <span class="editable"><span class="key hide"></span><span class="val">{{!:#data}}</span></span>
    {{!/if}}
    </div>
</div>
</script>
<script id="EditTmpl" type="text/x-jsrender">
{{!if ~isNull(prop)}}
    <div class="key">{{!keyToHtml:key}}: 
        <div class="add null"><span class="key hide">{{!:key}}</span>Add {{!singular:~get_class(~path,key)}}</div>
    </div>
{{!else ~isArray(prop)}}
    <div class="header key">{{!keyToHtml:key}}</div>
    {{!if ~isBasicArray(prop)}}
        {^{for prop ~key=key tmpl="#LoopTmplBasic" /}}
    {{!else}}
        {^{for prop ~key=key tmpl="#LoopTmpl" /}}
    {{!/if}}
    <div class="indent"><div class="add array"><span class="key hide">{{!:key}}</span>Add {{!singular:~get_class(~path,key)}}</div></div>
{{!else ~isObject(prop)}}
    <div class="header key">{{!keyToHtml:key}}</div>
    <div class="indent">
        <span class="path">{{!:~concat(~path,key)}}</span>
        {^{props prop ~path=~concat(~path,key) ~keyeditable=true tmpl="#EditTmpl" }}
        {{!else}}
          <span class="empty"></span>
        {{!/props}}
    </div>
    {{!if !(~isDataclass(~path,key))}}
    <div class="indent"><div class="add object"><span class="key hide">{{!:key}}</span>Add {{!singular:~get_class(~path,key)}}</div></div>
    {{!/if}}
{{!else ~isNotPrivate(key) }}
    <div>
    {{!if (~keyeditable && ~editable(key+"_key",~path)) }}
        <span class="editing"><span class="key hide">{{!:key}}</span><input class="key" type="text" data-link="key" />: {{!:prop}}</span>
    {^{else ~editable(key,~path)}}
        <span class="editing"><span class="key">{{!keyToHtml:key}}</span>: 
        {{!if ~isEnum(~path,key)}}
            <select required="true">
            {{!for ~getEnums(~path,key) ~enumVal=prop}}
                {{!if ~equal(~enumVal,#data)}}
                <option selected>{{!:#data}}</option>
                {{!else}}
                <option>{{!:#data}}</option>
                {{!/if}}
            {{!/for}}
            </select>
        {{!else}}
            <input type="text" data-link="{intToStr:prop:strToInt}" />
        {{!/if}}
        </span>
    {{!else}}
        {{!if ~keyeditable}}
        <span class="editable key_editable">
        {{!else}}
        <span class="editable">
        {{!/if}}
        <span class="key">{{!keyToHtml:key}}</span>: <span class="val">{{!:prop}}</span></span>
    {{!/if}}
    </div>
{{!/if}}
</script>
<script id="AdvTmpl" type="text/x-jsrender">
<div class="header key">Job</div>
<div class="indent">
    {^{props ~path="" tmpl="#EditTmpl" }}
    {{!else}}
      <span class="empty"></span>
    {{!/props}}
</div>
</script>
<script type="text/javascript" src="/static/json-rpc.js"></script>
<script type="text/javascript" src="/static/dataclasses.js"></script>
<script type="text/javascript" src="/static/jsviews.min.js"></script>
<script type="text/javascript" src="/static/submit.js"></script>
<script type="text/javascript">
jQuery(document).ready(function() {
    // initalize the submission form
    Submission("init",{passkey:"{{ passkey }}",
                       element:"#submit_area",
                       gridspec:{{ json_encode(gridspec) }}
                      });
});
</script>
{% end %}