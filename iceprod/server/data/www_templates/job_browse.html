{% extends "base.html" %}

{% block title %}Jobs - IceProd{% end %}

{% block page_title %}Jobs{% end %}

{% block body %}

<table class='task_table'>
    <tr>
        <th>ID</th>
        <th>Status</th>
        <th>Job Index</th>
        <th>Status Changed</th>
        {% if (current_user) %}
        <th><a href='javascript:set_jobs_status(task_ids_on_page, "reset", "{{ passkey }}", filter=["&task_status=failed", "&task_status=suspended"]);'>Reset All</a></th>
        <th><a href='javascript:set_jobs_status(task_ids_on_page, "reset", "{{ passkey }}");'>Hard Reset All</a></th>
        <th><a href='javascript:set_jobs_status(task_ids_on_page, "suspended", "{{ passkey }}");'>Suspend All</a></th>
        {% end %}
    </tr>
    {% for j in jobs %}
    <tr>
        <td><a href="/dataset/{{ url_escape(jobs[j]['dataset_id']) }}/job/{{ url_escape(jobs[j]['job_id']) }}">{{ escape(jobs[j]['job_id']) }}</a></td>
        <td>{{ jobs[j]['status'] }}</td>
        <td>{{ jobs[j]['job_index'] }}</td>
        <td>{{ jobs[j]['status_changed'] }}</td>
        {% if (current_user) %}
        <td><a href='set_jobs_status(["{{ jobs[j]['job_id'] }}"], "reset", "{{ passkey }}", filter=["&task_status=failed", "&task_status=suspended"]);'>Reset</a></td>
        <td><a href='set_jobs_status(["{{ jobs[j]['job_id'] }}"], "reset", "{{ passkey }}");'>Hard Reset</a></td>
        <td><a href='set_jobs_status(["{{ jobs[j]['job_id'] }}"], "suspended", "{{ passkey }}");'>Suspend</a></td>
        {% end %}
    </tr>
    {% end %}
</table>


{% end %}

{% block body_scripts %}

{% if (current_user) %}
<script type="text/javascript" src="/static/rest.js"></script>
<script type="text/javascript">
var job_ids_on_page = [
    {% for j in jobs %}
        "{{ jobs[j]['job_id'] }}", 
    {% end %}
    ];
{% end %}
</script>
{% end %}
