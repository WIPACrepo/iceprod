{% extends "base.html" %}

{% block title %}IceProd - Dataset {{ dataset_num }} Details{% end %}

{% block description %}{{ dataset["description"] }}{% end %}

{% block sidebar %}
<div class="section">
    <h4><a href="/submit">Submit New Dataset</a></h4>
    <div class="esc-separator"></div>
    <h4><a href="/submit">Submit Dataset like Current</a></h4>
</div>
{% end %}

{% block page_title %}Dataset {{ dataset_num }} Details{% end %}

{% block body %}
<div style="margin-bottom:1em">
  <a href="/config?dataset_id={{ dataset_id }}">View Config</a><span style="width:2.5em;display:inline-block"> </span>
  <a href="/config?edit=1&dataset_id={{ dataset_id }}">Edit Config</a>
</div>
<h2>Settings</h2>
<table class="settings key_value">
{% for k in dataset %}
<tr>
    <td class="key">{{ k }}</td>
    <td class="value">{{ dataset[k] }}</td>
</tr>
{% end %}
</table>

{% if (current_user) %}
<div style="padding:10px;">
    <a href='javascript:call("reset_dataset");'>Reset</a>
    <a href='javascript:call("hard_reset_dataset");'>Hard Reset</a>
    <a href='javascript:call("suspend_dataset");'>Suspend</a>
</div>
{% end %}

<h2>Tasks</h2>

<div class="tasks">
{% for s in tasks %}
<div>
  <div style="display:inline;width:40px"><a href="/task?status={{ url_escape(s) }}&dataset_id={{ url_escape(dataset_id) }}">{{ s }}</a></div>
  <div style="display:inline;width:40px">{{ tasks[s] }}</div>
</div>
{% end %}
</div>
<div class="task_completion">
    <h2>Task Status by Task Name</h2>
    <table>
        <tr>
            <th>Name</th>
            <th>Type</th>
            <th>Waiting</th>
            <th>Queued</th>
            <th>Running</th>
            <th>Complete</th>
            <th>Error</th>
        </tr>
        {% for t in task_info %}
        <tr>
            <td>{{ task_info[t]['task_name'] }}</td>
            <td>{{ task_info[t]['task_type'] }}</td>
            <td>{{ task_info[t]['num_waiting'] }}</td>
            <td>{{ task_info[t]['num_queued'] }}</td>
            <td>{{ task_info[t]['num_running'] }}</td>
            <td>{{ task_info[t]['num_completions'] }}</td>
            <td>{{ task_info[t]['num_error'] }}</td>
        </tr>
        {% end %}
    </table>
    <h3>Completion Statistics</h3>
    <table>
        <tr>
            <th>Name</th>
            <th>Avg (hours)</th>
            <th><sup>max</sup>/<sub>min</sub> (hours)</th>
            <th>Eff</th>
        </tr>
        {% for t in task_info %}
        <tr>
            <td>{{ task_info[t]['task_name'] }}</td>
            <td>{{ '{:.2f}'.format(task_info[t]['avg_runtime']/3600) }}</td>
            <td><sup>{{ '{:0.2f}'.format(task_info[t]['max_runtime']/3600) }}</sup>/<sub>{{ '{:0.2f}'.format(task_info[t]['min_runtime']/3600) }}</sub></td>
            <td>{{ '{:d}'.format(int(task_info[t]['efficiency']*100)) }}%</td>
        </tr>
        {% end %}
    </table>
</div>

{% end %}

{% block body_scripts %}

{% if (current_user) %}
<script type="text/javascript" src="/static/json-rpc.js"></script>
<script type="text/javascript">
    var dataset_id = "{{ dataset_id }}";
    function call(func_name){
        RPCclient(func_name, {passkey: "{{ passkey }}", dataset_id:dataset_id }, callback=function(return_data){
            location.reload(true);
        });
    };
</script>
{% end %}

{% end %}
